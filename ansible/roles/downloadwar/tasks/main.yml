- name: Fetch maven-metadata.xml content from Nexus
  uri:
    url: "http://13.126.68.188:8081/repository/maven-snapshots/com/maven/SimpleWebApplication/1.0.0-SNAPSHOT/maven-metadata.xml"
    method: GET
    user: "{{ nexus_username }}"
    password: "{{ nexus_password }}"
    force_basic_auth: yes
    return_content: yes
  register: metadata_content

- name: Extract the latest version from maven-metadata.xml
  set_fact:
    latest_version: "{{ (metadata_content.content | regex_search('<value>(.*?)</value>')) | first }}"

- name: Debug the latest version
  debug:
    msg: "Latest Artifact Version: {{ latest_version }}"

- name: Download the latest WAR file from Nexus
  get_url:
    url: "http://13.126.68.188:8081/repository/maven-snapshots/com/maven/SimpleWebApplication/1.0.0-SNAPSHOT/SimpleWebApplication-{{ latest_version }}.war"
    dest: /home/tomcat1/apache-tomcat-10.1.31/webapps/
    mode: 0755
    owner: tomcat1
    group: tomcat1
    username: "{{ nexus_username }}"
    password: "{{ nexus_password }}"
